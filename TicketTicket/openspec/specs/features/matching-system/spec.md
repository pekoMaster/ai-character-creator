# 配對與溝通系統規格

## 概述
處理同行申請、配對確認，以及配對後的私訊溝通。

---

## 功能需求

### F-MTH-001: 申請加入
- 賓客 SHALL 能夠申請加入 `open` 狀態的刊登
- 申請 SHALL 包含選填的自我介紹訊息
- 系統 SHALL 防止重複申請同一刊登
- 系統 SHALL 防止主辦方申請自己的刊登

#### Scenario: 成功申請
- **Given** 用戶查看一個 open 狀態的刊登
- **When** 用戶點擊「申請加入」並送出
- **Then** 系統 SHALL 建立 pending 狀態的申請
- **And** 系統 SHALL 通知主辦方

#### Scenario: 防止重複申請
- **Given** 用戶已申請過某刊登
- **When** 用戶嘗試再次申請
- **Then** 系統 SHALL 顯示「您已申請過此刊登」
- **And** 系統 SHALL 阻止重複申請

### F-MTH-002: 管理申請
- 主辦方 SHALL 能夠查看所有申請
- 主辦方 SHALL 能夠接受或拒絕申請
- 接受申請 SHALL 減少 availableSlots
- 當 availableSlots = 0，刊登狀態 SHALL 變為 matched

#### Scenario: 接受申請
- **Given** 刊登有 2 個可用名額
- **When** 主辦方接受 1 個申請
- **Then** availableSlots SHALL 變為 1
- **And** 申請狀態 SHALL 變為 accepted
- **And** 開放該用戶的聊天功能

#### Scenario: 額滿自動配對
- **Given** 刊登只剩 1 個可用名額
- **When** 主辦方接受申請
- **Then** availableSlots SHALL 變為 0
- **And** 刊登狀態 SHALL 變為 matched

### F-MTH-003: 私訊聊天
- 系統 SHALL 僅對已配對的用戶開放聊天
- 聊天 SHALL 顯示安全警告橫幅
- 訊息 SHALL 即時更新（模擬）

### F-MTH-004: 安全警告
- 聊天介面 SHALL 持續顯示安全警告：
  > ⚠️ 安全提醒：主辦方須親自在場才能入場。請勿在線上轉帳。請在場地見面。

- 安全警告 SHALL 不可關閉
- 安全警告 SHALL 固定在聊天頂部

### F-MTH-005: 我的配對
- 系統 SHALL 顯示用戶的所有配對
- 分為「作為主辦方」和「作為賓客」兩類
- 每個配對顯示狀態和快速進入聊天入口

---

## UI 規格

### 申請對話框
```
┌─────────────────────────────────────┐
│ 申請加入同行                      ✕  │
├─────────────────────────────────────┤
│                                     │
│ 🎵 YOASOBI Live 2025               │
│ 📅 2025/03/15                       │
│ 💰 $1,000/人                        │
│                                     │
│ 自我介紹 (選填)                      │
│ ┌─────────────────────────────────┐ │
│ │ 嗨！我是忠實粉絲，這是我第三次    │ │
│ │ 參加 YOASOBI 的演唱會...         │ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
│ 0/200 字                            │
│                                     │
│ ⚠️ 提醒：                           │
│ • 付款將在見面時以現金進行           │
│ • 請準時出現於約定地點               │
│ • 詳情請待配對後與主辦方確認          │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │           送出申請               │ │
│ └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

### 申請管理（主辦方視角）
```
┌─────────────────────────────────────┐
│ ← 管理申請                          │
├─────────────────────────────────────┤
│                                     │
│ YOASOBI Live 2025                   │
│ 收到 3 個申請 • 1/2 名額可用         │
│                                     │
├─────────────────────────────────────┤
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 👤 sakura_fan                   │ │
│ │ ⭐ 4.8 (15 評價)                 │ │
│ │                                 │ │
│ │ 「嗨！我是忠實粉絲...」           │ │
│ │                                 │ │
│ │ [接受]  [拒絕]                  │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 👤 music_lover                  │ │
│ │ ⭐ 新用戶                        │ │
│ │                                 │ │
│ │ 未留言                           │ │
│ │                                 │ │
│ │ [接受]  [拒絕]                  │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ───── 已處理 ─────                  │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 👤 concert_fan ✅ 已接受        │ │
│ │ ⭐ 4.5 (8 評價)                  │ │
│ │                                 │ │
│ │ [進入聊天]                       │ │
│ └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

### 聊天介面
```
┌─────────────────────────────────────┐
│ ← 與 sakura_fan 聊天                │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ ⚠️ 安全提醒：主辦方須親自在場才   │ │
│ │ 能入場。請勿在線上轉帳。請在場    │ │
│ │ 地見面。                         │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│                                     │
│ 📅 活動: YOASOBI Live 2025         │
│ 📍 見面: 東京巨蛋 A 入口，17:00     │
│ 💰 費用: $1,000/人                  │
│                                     │
├─────────────────────────────────────┤
│                                     │
│         ┌───────────────────┐      │
│         │ 嗨！期待見面！      │      │
│         │              14:30 │      │
│         └───────────────────┘      │
│                                     │
│ ┌───────────────────┐              │
│ │ 我也是！請問有      │              │
│ │ 什麼注意事項嗎？    │              │
│ │ 14:32              │              │
│ └───────────────────┘              │
│                                     │
│         ┌───────────────────┐      │
│         │ 記得帶身分證喔～    │      │
│         │              14:35 │      │
│         └───────────────────┘      │
│                                     │
├─────────────────────────────────────┤
│ ┌─────────────────────────┐ [送出] │
│ │ 輸入訊息...              │        │
│ └─────────────────────────┘        │
└─────────────────────────────────────┘
```
